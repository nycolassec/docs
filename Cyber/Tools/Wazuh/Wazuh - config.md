# Architectural Structure of Wazuh
Wazuh can be installed as an all-in-one or distributed structure in an on-prem installation architecturally. Wazuh consists of 4 basic components.

**Wazuh Indexer**
The Wazuh indexer is a highly scalable full-text search and analysis engine. It is responsible for indexing and storing alerts generated by the Wazuh server. 

**Wazuh Server** 
The server manages the agents, configuring and updating them remotely when necessary. This component analyzes the data received from the agents, processing it through decoders and rules and using threat intelligence to look for indicators of compromise.

**Wazuh Dashboard**
A flexible and intuitive web interface for data mining, analysis, and visualization. 

**Wazuh Agent**
The Wazuh agent is a multi-platform component that runs on the endpoints to be monitored. It provides detection, prevention and response capabilities.

![[Pasted image 20250312131927.png]]
***
# Instalação

## Server
Podemos fazer o download de um script do Wazuh  para facilitar a instalação. Também devemos dar permissão de execução.
```
curl -sO https://packages.wazuh.com/4.11/wazuh-install.sh
chmod +x ./wazuh-install.sh
```

Após isso podemos passar algumas flags, encorajo vocês a pesquisarem as possíveis flags, mas irei utilizar a ``-a`` e ``-i``.
`-a` : Instala todos os componentes do Wazuh(**indexer**, **server** e **dashboard**) .
`-i` : Ignora os requisitos mínimos de hardware.

```
./wazuh-install.sh -a -i
```
Após a conclusão, ele irá mostrar no terminal as credenciais de login.

>Aviso
>Caso esteja utilizando algum firewall, libere as portas 1514, 1515 e 443.
>Mas não se preocupe, ele te lembrará na hora que estiver instalando.
## Client
Após fazer a implantação do server podemos adicionar agents, que são os clients.
Na página inicial após o login, devemos ir em **Deploy new agent**.
![[Pasted image 20250314113106.png]]

Escolhemos a plataforma e seguimos os passos necessários.
![[Pasted image 20250314113236.png]]

***
# Sysmon Logs
Após a instalação do **Sysmon** devemos acessar o agent no host em `C:\Program Files (x86)\ossec-agent\win32ui.exe` > ``View`` > ``View Config`` e então adicionarmos a configuração na seção ``<! -- Log analysis -->``

```
<localfile>      
	<location>Microsoft-Windows-Sysmon/Operational</location>     
	<log_format>eventchannel</log_format>  
</localfile>
```

![[Pasted image 20250312154928.png]]
***
# Nginx Logs
Aqui podemos editar o arquivo de configuração do agent `/var/ossec/etc/ossec.conf`, e então adicionarmos a configuração na seção `<! -- Log analysis -->`.

```
<localfile>
	<log_format>syslog</log_format>
	<location>/var/log/nginx/access.log</location>     
</localfile>
```
***
# Syslog
Aqui editamos o arquivo de configuração do Wazuh Server `/var/ossec/etc/ossec.conf`, e então adicionarmos a configuração em uma tag ``remote``.

```
<remote>
<connection>syslog</connection>
<port>514</port>
<protocol>udp</protocol>
<allowed-ips>172.16.8.88</allowed-ips>
</remote>
```